function formSend(){movie_1=void 0,movie_2=void 0;var e=document.forms.search_form.movie_1.value,t=document.forms.search_form.movie_2.value,r=e.toLowerCase().trim().replace(/\s/g,"+"),s=t.toLowerCase().trim().replace(/\s/g,"+"),o="http://www.omdbapi.com/?t=",i=o+r,n=o+s;setHistory(e,t),search_history_div.innerHTML=getHistory(),getMovie_1(i),getMovie_2(n);var a=setInterval(function(){void 0!=movie_1&&void 0!=movie_2&&(search_results_div.innerHTML=compareMovie(e,t,movie_1,movie_2),clearInterval(a))},100)}function getMovie_1(e){return getJSON(e,function(e){movie_1=e},function(e){console.error("Connect error")})}function getMovie_2(e){return getJSON(e,function(e){movie_2=e},function(e){console.error("Connect error")})}function compareMovie(e,t,r,s){var o=new String,i=new String,n=!1,a=[],c=[],v=[];return"False"==r.Response||"False"==s.Response?(i="False"==r.Response?"False"==s.Response?e+", "+t:e:t,search_results_div.classList.remove("--success"),search_results_div.classList.add("--error"),o="<p>Nie znaleziono filmu: "+i+"</p>"):("N/A"!=r.Director&&r.Director==s.Director&&(search_results_div.classList.remove("--error"),search_results_div.classList.add("--success"),o="<h2>Wspólna obsada</h2>",o+='<p class="movie__director"><strong>Reżyser:</strong> '+r.Director+"</p>",n=!0),a=_.map(r.Actors.split(","),function(e){return e.trim()}),c=_.map(s.Actors.split(","),function(e){return e.trim()}),v=_.intersection(a,c),""!=v&&(v=_.map(v,function(e){return" "+e}),n||(search_results_div.classList.remove("--error"),search_results_div.classList.add("--success"),o="<h2>Wspólna obsada</h2>"),o+='<p class="movie__actors"><strong>Aktorzy:</strong>'+v+"</p>"),""==o&&(search_results_div.classList.remove("--success"),search_results_div.classList.add("--error"),o="<p>Brak wspólnej obsady.</p>")),o}function getDateTime(){var e=new Date,t=e.getFullYear(),r=e.getMonth()+1,s=e.getDate(),o=e.getHours(),i=e.getMinutes(),n=e.getSeconds();if(1==r.toString().length)var r="0"+r;if(1==s.toString().length)var s="0"+s;if(1==o.toString().length)var o="0"+o;if(1==i.toString().length)var i="0"+i;if(1==n.toString().length)var n="0"+n;var a=s+"."+r+"."+t+" "+o+":"+i+":"+n;return a}function getHistory(){var e=localStorage.getItem("myHistory"),t=new String;if(e){var r=e.split(";");r=_.map(r,function(e){return _.object(["date","movie1","movie2"],e.split(","))}),t="<h2>Ostatnie wyszukiwania</h2>",t+="<table>",t+="<thead>",t+="<tr>",t+="<th>Data</th><th>Film 1</th><th>Film 2</th>",t+="</tr>",t+="</thead>",t+="<tbody>",_.each(r,function(e){t+="<tr>",t+="<td>"+e.date+"</td><td>"+e.movie1+"</td><td>"+e.movie2.trim()+"</td>",t+="</tr>"}),t+="</tbody>",t+="</table>"}return t}function setHistory(e,t){var r=localStorage.getItem("myHistory"),s=new String,o=getDateTime();if(r){var i=r.split(";");i.length>=10&&(i.pop(),r=i.join(";")),s=o+","+e+", "+t+";"+r}else s=o+","+e+", "+t;localStorage.setItem("myHistory",s)}var movie_1,movie_2,search_history_div=document.getElementById("search_history"),search_results_div=document.getElementById("search_results");search_history_div.innerHTML=getHistory(),document.getElementById("formSubmit").addEventListener("click",function(){document.forms.search_form.movie_1.classList.add("validation"),document.forms.search_form.movie_2.classList.add("validation")});var getJSON=function(e,t,r){var s="undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");s.onreadystatechange=function(){var e;4==s.readyState&&(e=s.status,200==e?t(s.response):r(e))},s.open("GET",e,!0),s.responseType="json",s.send()};